// Generated by CoffeeScript 1.12.6
(function() {
  var checkEligibility, initCaptcha, recaptchaPublicKey, reloadCaptcha, setRequired, submitRegistration;

  setRequired = function() {
    return $('#user-registration-form :input').each(function() {
      if (!$(this).is(':checkbox')) {
        if (!$(this).is(':radio')) {
          return $(this).prop('required', $(this).is(":visible"));
        }
      }
    });
  };

  submitRegistration = function(e) {
    var creatingNewTeam, logType, registrationData, submitButton;
    e.preventDefault();
    registrationData = $("#user-registration-form").serializeObject();
    creatingNewTeam = $("#registration-new-team-page").is(":visible");
    registrationData["create-new-team"] = creatingNewTeam;
    if (creatingNewTeam) {
      registrationData["ctf-emails"] = $("#checkbox-emails-create").is(':checked');
      submitButton = "#register-button-create";
      logType = "NewTeam";
    } else {
      registrationData["ctf-emails"] = $("#checkbox-emails-existing").is(':checked');
      submitButton = "#register-button-existing";
      logType = "JoinTeam";
    }
    return apiCall("POST", "/api/user/create/", registrationData).done(function(data) {
      switch (data['status']) {
        case 0:
          $(submitButton).apiNotify(data, {
            position: "right"
          });
          ga('send', 'event', 'Registration', 'Failure', logType + "::" + data.message);
          return reloadCaptcha();
        case 1:
          ga('send', 'event', 'Registration', 'Success', logType);
          return document.location.href = window.baseurl + "/team";
      }
    });
  };

  $(function() {
    var offset = 0, pageTransitionSpeed = 200;
    apiCall("GET", "/api/user/status/").done(function(data) {});
    $("#user-registration-form").on("submit", submitRegistration);
    $("#registration-new-team-page").hide();
    $("#registration-join-team-page").hide();
    $("#button-new-team").click(function() {
      return $("#registration-join-team-page").hide("slide", {
        direction: "up"
      }, pageTransitionSpeed, function() {
        return $("#registration-new-team-page").show("slide", {
          direction: "up"
        }, pageTransitionSpeed, function() {
          ga('send', 'event', 'Registration', 'Switch', 'NewTeam');
          return setRequired();
        });
      });
    });
    $("#button-join-team").click(function() {
      return $("#registration-new-team-page").hide("slide", {
        direction: "up"
      }, pageTransitionSpeed, function() {
        return $("#registration-join-team-page").show("slide", {
          direction: "up"
        }, pageTransitionSpeed, function() {
          ga('send', 'event', 'Registration', 'Switch', 'JoinTeam');
          return setRequired();
        });
      });
    });
  });

}).call(this);
